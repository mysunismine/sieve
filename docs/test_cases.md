# Тест-кейсы сервисного слоя

## Google Search Service
- **Успешное выполнение запроса**: проверяем, что `search_google` формирует параметры запроса, учитывает ограничение `min_top_n/max_top_n` и корректно преобразует элементы ответа в `SearchResult`.
- **Сетевая ошибка**: эмулируем исключение `httpx.ReadTimeout` и убеждаемся, что возбуждается `GoogleSearchError`.
- **Некорректный статус ответа**: возвращаем ответ со статусом 500 и ожидаем `GoogleSearchError`.

## History Store
- **Добавление записей и усечение размера**: добавляем несколько записей и проверяем, что новые элементы попадают в начало списка, а размер не превышает `max_size`.
- **Удаление записи**: удаляем существующую запись и убеждаемся, что метод возвращает `True`, а повторное удаление возвращает `False`.
- **Очистка истории**: после вызова `clear` список записей пуст.

## Ask Validators
- **Пустой запрос**: `clean_query` должен возбуждать `AskServiceError` со статусом 422, если строка состоит из пробелов.
- **Неверная модель**: `resolve_model` отклоняет значение, которого нет в списке разрешённых моделей.
- **Корректный диапазон топ-N**: `resolve_top_n` ограничивает значение минимальными и максимальными пределами из настроек.

## OpenAI Client Service
- **Успешная генерация ответа**: проверяем, что `generate_answer` отправляет корректный запрос, возвращает текст ответа и идентификатор.
- **Ошибка статуса OpenAI**: при статусе ответа 500 возбуждается `OpenAIError`.
- **Пустой ответ**: при отсутствии текстовых блоков в ответе возбуждается `OpenAIError`.
